#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  ğŸ§ª How to Test Daily Subscription Renewal                     â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“ STEP-BY-STEP GUIDE:"
echo ""
echo "1ï¸âƒ£  Open your browser:"
echo "    â†’ http://localhost:3000/support"
echo ""
echo "2ï¸âƒ£  Find 'Test DennÃ©' tier (at the top, yellow border):"
echo "    - Price: â‚¬1/deÅˆ"
echo "    - Badge: ğŸ§ª TEST MODE"
echo "    - Features: Obnovuje sa kaÅ¾dÃ½ deÅˆ"
echo ""
echo "3ï¸âƒ£  Click 'VybraÅ¥ plÃ¡n' button"
echo ""
echo "4ï¸âƒ£  Enter test payment details:"
echo "    Card number: 4242 4242 4242 4242"
echo "    Expiry: Any future date (e.g., 12/26)"
echo "    CVC: Any 3 digits (e.g., 123)"
echo "    Name: Your name"
echo "    Email: Your email"
echo ""
echo "5ï¸âƒ£  Complete payment"
echo "    â†’ You'll be redirected to /thank-you"
echo ""
echo "6ï¸âƒ£  Go to your account:"
echo "    â†’ http://localhost:3000/account"
echo ""
echo "7ï¸âƒ£  Find 'Active Subscription' section:"
echo "    You should see:"
echo "    - Plan: Test Daily"
echo "    - Price: â‚¬1/day"
echo "    - Status: Active"
echo "    - Renews on: [tomorrow's date]"
echo ""
echo "8ï¸âƒ£  Look for subscription ID in one of these places:"
echo ""
echo "    A) In browser console (if debug logs enabled)"
echo "    B) In Stripe Dashboard:"
echo "       â†’ https://dashboard.stripe.com/test/subscriptions"
echo "       â†’ Click on the subscription"
echo "       â†’ Copy ID from URL or page (starts with 'sub_1...')"
echo ""
echo "    C) Query database directly:"
echo "       psql or Supabase SQL Editor:"
echo ""
cat << 'SQL'
       SELECT 
         stripe_subscription_id,
         tier,
         status,
         current_period_end
       FROM subscriptions 
       WHERE tier = 'test_daily'
       ORDER BY created_at DESC
       LIMIT 1;
SQL
echo ""
echo "9ï¸âƒ£  Copy the subscription ID (example: sub_1SQaZhKF1O52aJAIYkK0ZK7o)"
echo ""
echo "ğŸ”Ÿ Run the test script:"
echo "    â†’ ./test-daily-renewal.sh sub_1SQaZhKF1O52aJAIYkK0ZK7o"
echo "                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^"
echo "                              Replace with YOUR actual ID!"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ… EXPECTED RESULTS after running script:"
echo ""
echo "  â€¢ Server logs show:"
echo "    ğŸ’° Invoice paid for subscription: sub_xxx"
echo "    âœ… Subscription updated with new billing period"
echo ""
echo "  â€¢ /account page shows updated 'Renews on' date (+1 day)"
echo ""
echo "  â€¢ Database current_period_end is +1 day from before"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ” TESTING MULTIPLE RENEWALS:"
echo ""
echo "  Run the script multiple times to simulate multiple days:"
echo ""
echo "  ./test-daily-renewal.sh sub_xxx  # Day 1 â†’ Day 2"
echo "  ./test-daily-renewal.sh sub_xxx  # Day 2 â†’ Day 3"
echo "  ./test-daily-renewal.sh sub_xxx  # Day 3 â†’ Day 4"
echo ""
echo "  Each run advances the renewal date by 1 day!"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "â“ TROUBLESHOOTING:"
echo ""
echo "  Problem: Can't see 'Test DennÃ©' tier"
echo "  â†’ Dev server needs restart (Ctrl+C, then npm run dev)"
echo "  â†’ Hard refresh browser (Cmd+Shift+R)"
echo ""
echo "  Problem: Payment fails"
echo "  â†’ Check .env.local has STRIPE_PRICE_TEST_DAILY set"
echo "  â†’ Check Stripe dashboard - product should exist"
echo ""
echo "  Problem: Script says 'subscription not found'"
echo "  â†’ You used placeholder 'sub_YOUR_SUBSCRIPTION_ID'"
echo "  â†’ Get real ID from step 8 above!"
echo ""
echo "  Problem: Webhook not received"
echo "  â†’ Check Stripe CLI listener: ps aux | grep 'stripe listen'"
echo "  â†’ Should see: PID 15794 (or similar)"
echo "  â†’ If not running: stripe listen --forward-to localhost:3000/api/webhooks/stripe"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“š MORE INFO:"
echo "  â†’ Read: DAILY_SUBSCRIPTION_TESTING.md"
echo "  â†’ Read: SUBSCRIPTION_RENEWAL_FLOW.md"
echo ""
echo "ğŸš€ Ready? Start with Step 1 above!"
echo ""
